!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).routerHelper=t()}(this,(function(){"use strict";function e(e){if(void 0!==e.Vue&&void 0!==e.router){var t,n=e.Vue,o=e.router,r=o.mode,i=e.replaceStay||[],c=!1;o._stack=0;var a,s=!1,u=0,p=!1,f={};o.beforeEach((function(e,n,o){t=x(),o()})),o.afterEach((function(e,r){p=!0,n.nextTick((function(){void 0===t?d():s?y():O()?v():l(),u=Number(o._stack),A();var e=x();!c&&e&&k(e.$vnode.parent.componentInstance),p=!1}))}));var h=o.replace;o.replace=function(e,t,n){if(s=!0,a=o.history.current.path,!t&&!n&&"undefined"!=typeof Promise)return new Promise((function(t,n){h.call(o,e).then((function(){return t()})).catch((function(e){s=!1,a=void 0,n(e)}))}));h.call(o,e,t,(function(e){s=!1,a=void 0,E(n)&&n(e)}))};var d=function(e){E(_())?o._stack=_():g(0),m(x())},v=function(){o._stack++,g(o._stack),m(x())},l=function(){o._stack--,$(o._stack),m(x())},y=function(){E(a)&&-1!==i.indexOf(a)||t.$keepAliveDestroy(),g(o._stack),m(x()),s=!1,a=void 0},k=function(e){N(e,I(o._stack));var t=e.$options.render;e.$options.render=function(){var e=this.$slots.default,n=S(e);return p?E(n.key)||(s?n.key=I(o._stack):O()?n.key=I(Number(o._stack)+1):n.key=I(Number(o._stack)-1)):n.key=I(o._stack),t.apply(this,arguments)},c=!0},m=function(e){var t=o._stack;if(f.hasOwnProperty(t)&&f[t]){f[t].push(e)}else{var n=[];n.push(e),f[t]=n}},$=function(e){!E(f)||f.length<=0||Object.keys(f).forEach((function(t){if(!(t<=e)){var n=f[t];if(E(n)&&!(n.length<=0))for(var o=n.pop();E(o);)o.$keepAliveDestroy(),o=n.pop()}}))},_=function(){var e=b();return E(e)?e.id:void 0},g=function(e){var t=("hash"===r?"#":"")+o.history.current.path;window.location.href.startsWith("file://")&&(t=("hash"===r?window.location.href.split("#")[0]:window.location.href.splice(".html")[0]+".html")+t);t+=w(o.history.current.query);var n=E(history.state)?history.state:{};n.id=e,history.replaceState(n,"",t)},w=function(e){var t="";return(t=Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")).length>0&&(t="?"+t),t},b=function(){return history.state},O=function(){return!s&&(!E(_())||u<_())},I=function(e){return"keep-alive-vnode-key"+Number(e)+o.history.current.path},x=function(){return o.history.current.matched.length>0?o.history.current.matched[0].instances.default:void 0},A=function(){var e,t=x();t&&t._vnode&&(t._vnode.key=(e=o._stack,"vnode-key"+Number(e)+o.history.current.path),t._vnode.parent.key=I(o._stack))},j=history.replaceState;history.replaceState=function(e,t,n){var o=Object.assign(history.state,e);j.call(history,o,t,n)};var N=function(e,t){if(E(e)&&E(e.cache)&&E(e.keys)){var n=e.keys,o=e.cache;if(1===n.length){var r=o[n[0]];delete o[n[0]],n.splice(0,1),n.push(t),o[t]=r}}},C=n.prototype.$destroy;n.prototype.$keepAliveDestroy=function(){if(this.$vnode&&this.$vnode.data.keepAlive&&this.$vnode.parent&&this.$vnode.parent.componentInstance&&this.$vnode.parent.componentInstance.cache&&this.$vnode.componentOptions){var e=E(this.$vnode.key)?this.$vnode.key:this.$vnode.componentOptions.Ctor.cid+(this.$vnode.componentOptions.tag?"::"+this.$vnode.componentOptions.tag:""),t=this.$vnode.parent.componentInstance.cache,n=this.$vnode.parent.componentInstance.keys;if(t[e]){if(n.length){var o=n.indexOf(e);o>-1&&n.splice(o,1)}delete t[e]}}C.apply(this,arguments)};var S=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t];if(E(n)&&(E(n.componentOptions)||D(n)))return n}},D=function(e){return e.isComment&&e.asyncFactory},E=function(e){return null!=e}}else console.warn("warning: router helper needs Vue and root router ,see more for guide : https://github.com/Zippowxk/vue-router-keep-alive-helper")}return"undefined"!=typeof window&&(window.createHelper=e),e}));
//# sourceMappingURL=index.js.map
