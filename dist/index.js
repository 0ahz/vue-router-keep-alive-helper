!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).routerHelper=t()}(this,(function(){"use strict";function e(e){var t=function(e){return null!=e};if(void 0!==e.Vue&&void 0!==e.router){var n,o=e.Vue,r=e.router,i=r.mode,a=e.replaceStay||[],c=!1;r._stack=0;var s,u=!1,f=0,p=!1,h={};r.beforeEach((function(e,t,o){n=j(),o()})),r.afterEach((function(e,t){p=!0,o.nextTick((function(){void 0===n?d():u?y():O()?l():v(),f=Number(r._stack),x();var e=j();!c&&e&&k(e.$vnode.parent.componentInstance),p=!1}))}));var d=function(e){t(w())?r._stack=w():g(0),m(j())},l=function(){r._stack++,g(r._stack),m(j())},v=function(){r._stack--,$(r._stack),m(j())},y=function(){t(s)&&-1!==a.indexOf(s)||n.$keepAliveDestroy(),g(r._stack),m(j()),u=!1,s=void 0},k=function(e){S(e,I(r._stack));var n=e.$options.render;e.$options.render=function(){var e=this.$slots.default,o=E(e);return p?t(o.key)||(u?o.key=I(r._stack):O()?o.key=I(Number(r._stack)+1):o.key=I(Number(r._stack)-1)):o.key=I(r._stack),n.apply(this,arguments)},c=!0},m=function(e){var t=r._stack;if(h.hasOwnProperty(t)&&h[t]){h[t].push(e)}else{var n=[];n.push(e),h[t]=n}},$=function(e){!t(h)||h.length<=0||Object.keys(h).forEach((function(n){if(!(n<=e)){var o=h[n];if(t(o)&&!(o.length<=0))for(var r=o.pop();t(r);)r.$keepAliveDestroy(),r=o.pop()}}))},w=function(){var e=b();return t(e)?e.id:void 0},g=function(e){var n=window.location.pathname+i==="hash"?window.location.hash:"";window.location.href.startsWith("file://")&&(n=("hash"===i?window.location.href.split("#")[0]:window.location.href.splice(".html")[0]+".html")+n);n+=_(r.history.current.query);var o=t(history.state)?history.state:{};o.id=e,history.replaceState(o,"",n)},_=function(e){var t="";return(t=Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")).length>0&&(t="?"+t),t},b=function(){return history.state},O=function(){return!u&&(!t(w())||f<w())},I=function(e){return"keep-alive-vnode-key"+Number(e)+r.history.current.path},j=function(){return r.history.current.matched.length>0?r.history.current.matched[0].instances.default:void 0},x=function(){var e=j();e&&e._vnode&&(e._vnode.parent.key=I(r._stack))},A=history.replaceState;history.replaceState=function(e,t,n){var o=Object.assign({},history.state),r=Object.assign(o,e);A.call(history,r,t,n)};var C=r.replace;r.replace=function(e,n,o){if(u=!0,s=r.history.current.path,!n&&!o&&"undefined"!=typeof Promise)return new Promise((function(t,n){C.call(r,e).then((function(){return t()})).catch((function(e){u=!1,s=void 0,n(e)}))}));C.call(r,e,n,(function(e){u=!1,s=void 0,t(o)&&o(e)}))};var N=r.go;r.go=function(e){return u=!1,N.call(r,e)};var P=r.push;r.push=function(e,t,n){if(u=!1,!t&&!n&&"undefined"!=typeof Promise)return P.call(r,e,t,n);P.call(r,e,t,n)};var S=function(e,n){if(t(e)&&t(e.cache)&&t(e.keys)){var o=e.keys,r=e.cache;if(1===o.length){var i=r[o[0]];delete r[o[0]],o.splice(0,1),o.push(n),r[n]=i}}},D=o.prototype.$destroy;o.prototype.$keepAliveDestroy=function(){if(this.$vnode&&this.$vnode.data.keepAlive&&this.$vnode.parent&&this.$vnode.parent.componentInstance&&this.$vnode.parent.componentInstance.cache&&this.$vnode.componentOptions){var e=t(this.$vnode.key)?this.$vnode.key:this.$vnode.componentOptions.Ctor.cid+(this.$vnode.componentOptions.tag?"::"+this.$vnode.componentOptions.tag:""),n=this.$vnode.parent.componentInstance.cache,o=this.$vnode.parent.componentInstance.keys;if(n[e]){if(o.length){var r=o.indexOf(e);r>-1&&o.splice(r,1)}delete n[e]}}D.apply(this,arguments)};var E=function(e){if(Array.isArray(e))for(var n=0;n<e.length;n++){var o=e[n];if(t(o)&&(t(o.componentOptions)||T(o)))return o}},T=function(e){return e.isComment&&e.asyncFactory}}else console.warn("warning: router helper needs Vue and root router ,see more for guide : https://github.com/Zippowxk/vue-router-keep-alive-helper")}return"undefined"!=typeof window&&(window.createHelper=e),e}));
//# sourceMappingURL=index.js.map
